<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>传感器噪声注入验证</title>
    <style>
        body { font-family: monospace; line-height: 1.5; padding: 20px; }
        .val { color: #007bff; font-weight: bold; }
        .delta-box { border-left: 4px solid #ccc; padding-left: 10px; margin-top: 10px; }
        .highlight { color: #28a745; font-weight: bold; }
    </style>
</head>
<body>
    <h3>实时数据 (已修正跳变逻辑)</h3>
    <div>Alpha: <span id="alpha" class="val">0</span></div>
    <div>Beta : <span id="beta" class="val">0</span></div>
    <div>Gamma: <span id="gamma" class="val">0</span></div>
    
    <div class="delta-box">
        <div>有效波动 (Clean Delta): <span id="delta" class="val">0</span></div>
        <div id="status">检测中...</div>
    </div>

    <script>
        let lastAlpha = 0;

        window.addEventListener('deviceorientation', (event) => {
            const a = event.alpha || 0;
            const b = event.beta || 0;
            const g = event.gamma || 0;

            document.getElementById('alpha').innerText = a.toFixed(6);
            document.getElementById('beta').innerText = b.toFixed(6);
            document.getElementById('gamma').innerText = g.toFixed(6);

            // --- 核心修正逻辑：处理 360 度循环误差 ---
            let diff = Math.abs(a - lastAlpha);
            if (diff > 180) {
                // 如果差值大于 180，说明发生了从 359.9 到 0.1 的边界跳变
                // 我们取其圆周上的最短距离
                diff = Math.abs(diff - 360);
            }

            document.getElementById('delta').innerText = diff.toFixed(8);

            // 状态判定
            const statusEl = document.getElementById('status');
            if (diff > 0.001) {
                statusEl.innerHTML = '<span class="highlight">正在注入动态噪声 (滑动中)</span>';
            } else {
                statusEl.innerText = '当前为保底底噪 (静止)';
            }

            lastAlpha = a;
        }, true);
    </script>
</body>
</html>
